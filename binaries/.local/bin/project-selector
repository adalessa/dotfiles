#!/bin/env sh
projects=()

project_dirs=(
    "/home/$USER/code/php/"
    "/home/$USER/code/js/"
    "/home/$USER/code/go/src/github.com/adalessa/"
    "/home/$USER/code/go/src/github.com/wkda/"
)

for directory in "${project_dirs[@]}"
do
    if [[ -d $directory ]]; then
        for p in "${directory}*"
        do
            projects+=($p)
        done
    fi
done

selected=$(printf "%s\n" "${projects[@]}" | fzf)

[ -z $selected ] && exit

if [ ! -f "$selected/.project.sh" ]; then
    project=$(basename $selected)
    sessions=$(tmux ls | grep $project: | wc -l)
    if [ $sessions -eq 0 ]; then
        tmux new-session -d -s "$project" "cd "$selected" && nvim"
    fi

    tmux switch -t "${project}"
else
    "$selected"/.project.sh
fi


exit 0
